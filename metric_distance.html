<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>فضای متریک تعاملی</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
<style>
body { font-family: Tahoma,sans-serif; background:#f0f0f0; margin:0; padding:20px; text-align:center;}
h1{color:#2c3e50;}
.container{background:rgb(123, 165, 207);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.1);padding:24px;max-width:960px;}
#canvasContainer{width:800px;height:600px;margin:0 auto 20px;border-radius:12px;overflow:hidden;}
#distance{font-size:5vw;font-weight:bold;color:#2c3e50;margin:15px 0;}
.controls{margin:10px 0;}
select,input[type=number],button{padding:8px 14px;font-size:3vw;margin:5px;border-radius:8px;border:1px solid #ddd;background:white;}
button{background:#979797;color:white;border:none;cursor:pointer;}
button:hover{background:#979797;}
.coords{font-size:3vw;margin:5px;}
.coord-input{width:60px;}
.tip{color:#2127d6;font-size:3vw;margin-top:10px;line-height:1.5;}
label{font-size: 3vw;}
</style>
</head>
<body>

<div class="container">

<p id="distance">فاصله: ۰</p>

<div class="controls">
  <p style="display: inline; font-size: 3vw;"> با دکمه روبه‌رو بین حالت دوبعدی و سه‌بعدی جابه‌جا شوید.</p>
<button onclick="switchDimension()">2D / 3D</button>
<label>متریک:</label>
<select id="metricSelect">
<option value="euclidean">اقلیدسی</option>
<option value="manhattan">منهتن</option>
<option value="chebyshev">چبیشف</option>
<option value="discrete">گسسته</option>
</select>
<button onclick="resetPoints()">ریست نقاط</button>

</div>

<div class="controls">
<p style="font-size: 3vw;">مختصات نقاط:</p>
<div class="coords">
P1: X <input type="number" id="x1" class="coord-input"> 
    Y <input type="number" id="y1" class="coord-input"> 
    Z <input type="number" id="z1" class="coord-input">
    <button onclick="updatePoint(0)">به‌روزرسانی</button>
</div>
<div class="coords">
P2: X <input type="number" id="x2" class="coord-input"> 
    Y <input type="number" id="y2" class="coord-input"> 
    Z <input type="number" id="z2" class="coord-input">
    <button onclick="updatePoint(1)">به‌روزرسانی</button>
</div>
</div>
    <p class="tip" id="tipText"></p>
</div>
    <div id="canvasContainer"></div>

<script>
let points = [];
let metric = 'euclidean';
let is3D = true;
const RANGE = 350;
let p5Instance;
let initial3DView = true; 

function recreateCanvas(){
  if(p5Instance) p5Instance.remove();
  p5Instance = new p5(sketch,'canvasContainer');
  updateTip();
}

const sketch = function(p){
  p.setup = function(){
    p.createCanvas(800,600,is3D?p.WEBGL:p.P2D);
  };

  p.draw = function(){
  p.background(240,245,250);
  if(is3D){
    if(initial3DView){
      p.rotateX(p.radians(-35));
      p.rotateY(p.radians(45)); 
      p.rotateZ(p.radians(180));
    } else {
      // بعد از کلیک کاربر فقط چرخش آزاد
      p.orbitControl(1,1,0);
    }
    drawGrid3D();
    drawAxes3D();
    drawPoints3D();
    drawPath3D();
  } else {
    p.translate(p.width/2,p.height/2);
    drawGrid2D();
    drawAxes2D();
    drawPoints2D();
    drawPath2D();
  }
};


  p.mousePressed = function(){
    if(!is3D && points.length<2){
      let x = p.map(p.mouseX,0,p.width,-RANGE,RANGE);
      let y = p.map(p.mouseY,0,p.height,RANGE,-RANGE);
      points.push({x,y,z:0});
      updateInputs();
      updateDistance();
    } else if(is3D){
      initial3DView = false; // کاربر شروع به چرخش کرد
    }
  };

  function drawAxes3D(){
    p.strokeWeight(4);
    p.stroke(220,50,50); p.line(0,0,0,RANGE,0,0); // X
    p.stroke(50,180,50); p.line(0,0,0,0,RANGE,0); // Y
    p.stroke(50,50,220); p.line(0,0,0,0,0,RANGE); // Z
  }

  function drawGrid3D(){
    p.stroke(180); p.strokeWeight(1);
    for(let i=-RANGE;i<=RANGE;i+=50){ p.line(i,0,-RANGE,i,0,RANGE); p.line(-RANGE,0,i,RANGE,0,i);}
  }

  function drawPoints3D(){ p.noStroke(); points.forEach((pt,i)=>{p.push(); p.fill(i===0?231:41,i===0?76:128,i===0?60:185); p.translate(pt.x,pt.z,pt.y); p.sphere(14); p.pop();});}

  function drawPath3D(){ if(points.length<2 || metric==='discrete') return; let a=points[0],b=points[1]; let dx=Math.abs(b.x-a.x),dy=Math.abs(b.y-a.y),dz=Math.abs(b.z-a.z); p.strokeWeight(6); if(metric==='euclidean')p.stroke(155,89,182),p.line(a.x,a.z,a.y,b.x,b.z,b.y); else if(metric==='manhattan'){p.stroke(39,174,96); p.line(a.x,a.z,a.y,b.x,a.z,a.y); p.line(b.x,a.z,a.y,b.x,b.z,a.y); p.line(b.x,b.z,a.y,b.x,b.z,b.y);} else if(metric==='chebyshev'){p.stroke(243,156,18); let m=Math.max(dx,dy,dz); if(m===dx)p.line(a.x,a.z,a.y,b.x,a.z,a.y); else if(m===dy)p.line(a.x,a.z,a.y,a.x,b.z,a.y); else p.line(a.x,a.z,a.y,a.x,a.z,b.y);}}

  function drawAxes2D(){ p.strokeWeight(4); p.stroke(220,50,50);p.line(-RANGE,0,RANGE,0); p.stroke(50,50,220);p.line(0,-RANGE,0,RANGE);}
  function drawGrid2D(){ p.stroke(180); p.strokeWeight(1); for(let i=-RANGE;i<=RANGE;i+=50){ if(i!==0){p.line(-RANGE,i,RANGE,i); p.line(i,-RANGE,i,RANGE);}}}
  function drawPoints2D(){ p.noStroke(); points.forEach((pt,i)=>{p.fill(i===0?231:41,i===0?76:128,i===0?60:185); p.ellipse(pt.x,-pt.y,20,20);});}
  function drawPath2D(){ if(points.length<2 || metric==='discrete') return; let a=points[0],b=points[1]; let ax=a.x,ay=-a.y,bx=b.x,by=-b.y; let dx=Math.abs(b.x-a.x),dy=Math.abs(b.y-a.y); p.strokeWeight(6); if(metric==='euclidean') p.stroke(155,89,182),p.line(ax,ay,bx,by); else if(metric==='manhattan'){p.stroke(39,174,96); p.line(ax,ay,bx,ay); p.line(bx,ay,bx,by);} else if(metric==='chebyshev'){p.stroke(243,156,18); if(dx>=dy)p.line(ax,ay,bx,ay); else p.line(ax,ay,ax,by);}}
};

function updateDistance(){ 
  if(points.length<2){ document.getElementById('distance').textContent='فاصله: ۰'; return; }
  let a=points[0],b=points[1];
  let dx=Math.abs(b.x-a.x),dy=Math.abs(b.y-a.y),dz=Math.abs(b.z-a.z),d=0;
  if(metric==='euclidean') d=Math.sqrt(dx*dx+dy*dy+dz*dz);
  else if(metric==='manhattan') d=dx+dy+dz;
  else if(metric==='chebyshev') d=Math.max(dx,dy,dz);
  else d=(dx===0&&dy===0&&dz===0)?0:1;
  document.getElementById('distance').textContent='فاصله: '+d.toFixed(2);
}

function resetPoints(){ points=[]; updateInputs(); updateDistance(); initial3DView=true;}
function switchDimension(){ is3D=!is3D; points=[]; initial3DView=true; recreateCanvas(); updateInputs(); }

document.getElementById('metricSelect').addEventListener('change',e=>{ metric=e.target.value; updateDistance(); });

function updatePoint(index){ 
  if(points.length<index+1) points[index]={x:0,y:0,z:0};
  points[index].x = Number(document.getElementById('x'+(index+1)).value);
  points[index].y = Number(document.getElementById('y'+(index+1)).value);
  points[index].z = Number(document.getElementById('z'+(index+1)).value);
  updateDistance();
}

function updateInputs(){
  if(points[0]){
    document.getElementById('x1').value = points[0].x.toFixed(0);
    document.getElementById('y1').value = points[0].y.toFixed(0);
    document.getElementById('z1').value = points[0].z.toFixed(0);
  }
  if(points[1]){
    document.getElementById('x2').value = points[1].x.toFixed(0);
    document.getElementById('y2').value = points[1].y.toFixed(0);
    document.getElementById('z2').value = points[1].z.toFixed(0);
  }
}

function updateTip(){
  let tip = document.getElementById('tipText');
  if(is3D) tip.innerHTML = "برای مشخص کردن نقاط، فقط از ورود مختصات استفاده کنید <br> نمودار را می‌توانید بچرخانید.";
  else tip.innerHTML = "با کلیک روی صفحه نقاط مشخص می‌شوند";
}

recreateCanvas();
</script>

</body>
</html>
